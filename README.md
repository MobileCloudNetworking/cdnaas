# CDNaaS

## Scope

Content Delivery Networks as a Service (CDNaaS) is a service that can be used independently or in combination with ICNaaS to improve the performance, efficiency and easiness of retrieving content in mobile networks. 

## Architecture

Our goal with the CDN service is to provide Open Source CDN software that can be run as a service, there are already a few services able to provide Cloud-Based CDNs but these are usually tied to a provider such as Amazon CloudFront. 

Furthermore, we are leveraging Swift capabilities, as this is compatible with the choice of OpenStack as one of the main cloud management stack in the MCN architecture. There is also a CDN service on top of Swift, developed by Rackspace, but this is not published under the same open source licence and is thus not viable for our usage.
This implementation of CDNaaS offers essential CDN possibilities as a service. Instead of relying on traditional CDN services, an EEU can now come to MCN and request a CDN service; he can then execute usual CDN functions such as adding and retrieving files. 
More details on the architecture can be found under D5.2, available freely on the MCN website.

## Installation
The CDN service can be started on its own as an independent component without service orchestrator. 
It is currently possible to try this out with an OpenStack Heat template ready to use deploying 3 VMs: An OpenStack Swift instance, a VM running the local CDN server and a VM running the Central server. This setup requires a working Heat installation and 3 floating IPs for the VMs. The Heat template returns the IPs of both Central and Local server. The server can then directly be used using the calls described in the API section.
To use the service in the MCN architecture it needs to be manually registered first. The CDN service makes use of the Keystone service registry, as it is possible to register external components inside. It can be done using the keystone command line client, through service-create and then endpoint-create, with both public and internal URL being the CDN central’s address (e.g. http://localhost:8182/). 
The CDN service can then be easily started using the API of its SO via the Service Manager (SM).
### Running and LifecycleAfter being deployed, the CDN service lives as a MCN support service. There is no creation of VMs after the initial deployment, and new enterprise users obtain new accounts on the same CDN architecture. 
This is because Swift already provides support for multitenancy through its connection with Keystone user accounts. When a user chooses to stop its use of the service, his account and dependencies are deleted but the service is still running.
## API### API Central CDN server
    POST /account    Creates a user account on the central server and on local PoPs.    Headers:     -	Content-Type: application/json    Body:    -	JSON string containing password of future user such as ‘{“password”:”passwd”}’    HTTP Response codes and body:    -	201 Created if the user was successfully added, with the answer’s body being a JSON string containing the username and the origin PoP of the new user such as ‘{“global_id”:”aaa-bbb-ccc”, “origin”:”http://local.pop:8181”}’        DELETE /account    Deletes a user account on the central server and on local PoPs.    Headers:     -	Content-Type: application/json    Body:    -	JSON string containing id and password of user to delete such as ‘{“global_id”:”aaa-bbb-ccc”, “global_password”:”passwd”}’    HTTP Response codes and body:    -	204 if the user was successfully deleted    -	409 if the user is unknown        POST /pop    Registers a new PoP on the central server. This should only be used by the Administrator to add new PoPs to the service.    Headers:     -	Content-Type: application/json    Body:    -	JSON string containing url, admin username and admin password of the PoP to be added such as ‘{“url”: “http://local.pop:8181”, “admin_uname”:”admin”, “admin_password”:”password”}’    HTTP Response codes and body:    -	201 if the PoP was successfully created    -	409 if a PoP at this url is already registered
## API local PoP CDN server    POST /cdn/[global_id]/[container_name]    Creates a container named [container_name] for user [global_id].    Headers:    -	X-Password: password of the [global_id] user.    Body:    -	None    HTTP Response codes and body:    -	201 if the container was successfully created    -	401 if the user is unknown        DELETE /cdn/[global_id]/[container_name]    Deletes a container named [container_name] for user [global_id].    Headers:    -	X-Password: password of the [global_id] user.    Body:    -	None    HTTP Response codes and body:    -	204 if the container was successfully deleted    -	401 if the user is unknown        POST /cdn/[global_id]/[container_name]/object    Adds or updates an object on the object server. The object’s name will be uploaded file’s name. The complete url will be /cdn/[global_id]/[container_name]/[object-name]    Headers:    -	X-Password: password of the [global_id] user.    -	Content-Type: multipart/form-data    Body:    -	A file object with key “file_content” and value the file.    HTTP Response codes and body:    -	201 if the object was successfully added / updated.    -	401 if the user is unknown.    -	400 if the request was malformed.        DELETE /cdn/[global_id]/[container_name]/[object-name]    Deletes an object from the object server.    Headers:    -	X-Password: password of the [global_id] user.    Body    -	None    HTTP Response codes and body:    -	204 if the object was successfully deleted.    -	401 if the user is unknown.    -	400 if the request is malformed.        GET /cdn/[global_id]/[container_name]/[object-name]    Retrieves an object from the PoP as a redirect to the Swift server.    Headers:    -	None    Body:    -	None    HTTP Response codes and body:    -	303 and a redirect to the actual object on Swift if it exists.    -	404 if the user, container or object does not exist.